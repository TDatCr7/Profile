{{ define "main" }}
<section class="cinema-wrap enter">

  <header class="cinema-hero surface-soft">
    <p class="kicker">ĐỒ ÁN CHUYÊN NGÀNH</p>
    <h1 class="headline cinema-title">{{ .Title }}</h1>

    {{ with .Params.subtitle }}
      <p class="subtitle cinema-subtitle">{{ . }}</p>
    {{ end }}

    <div class="cinema-meta">
      {{ with .Params.advisor }}
        <div class="cinema-meta-row">
          <span class="cinema-meta-k">Giảng viên hướng dẫn</span>
          <span class="cinema-meta-v">{{ . }}</span>
        </div>
      {{ end }}

      {{ if and .Params.start .Params.end }}
        <div class="cinema-meta-row">
          <span class="cinema-meta-k">Thời gian thực hiện</span>
          <span class="cinema-meta-v">{{ .Params.start }} → {{ .Params.end }}</span>
        </div>
      {{ end }}
    </div>

    {{ with .Params.tags }}
      <div class="chips cinema-chips">
        {{ range . }}<span class="chip chip-accent">{{ . }}</span>{{ end }}
      </div>
    {{ end }}

    <div class="cinema-actions">
      {{ with .Params.github }}
        <a class="btn btn-grad" href="{{ . }}" target="_blank" rel="noopener">GitHub</a>
      {{ end }}
    </div>
  </header>

  <section class="cinema-body">
    <div class="cinema-grid">
      {{ $videos := .Params.videos }}
      {{ if $videos }}
        {{ range $i, $v := $videos }}
          <article class="cinema-card surface-soft">
            <div class="cinema-video">
              {{/* Hỗ trợ 2 kiểu:
                    - $v.youtube: full URL hoặc id
                    - $v.src: fallback local mp4 (nếu còn dùng)
              */}}

              {{ if $v.youtube }}
                {{ $yt := $v.youtube }}
                {{/* nếu là URL dạng https://www.youtube.com/watch?v=ID hoặc youtu.be/ID thì lấy ID */}}
                {{ $id := $yt }}
                {{ if (findRE `v=([A-Za-z0-9_-]{6,})` $yt) }}
                  {{ $m := index (findRESubmatch `v=([A-Za-z0-9_-]{6,})` $yt) 0 }}
                  {{ $id = index $m 1 }}
                {{ else if (findRE `youtu\.be/([A-Za-z0-9_-]{6,})` $yt) }}
                  {{ $m := index (findRESubmatch `youtu\.be/([A-Za-z0-9_-]{6,})` $yt) 0 }}
                  {{ $id = index $m 1 }}
                {{ else if (findRE `embed/([A-Za-z0-9_-]{6,})` $yt) }}
                  {{ $m := index (findRESubmatch `embed/([A-Za-z0-9_-]{6,})` $yt) 0 }}
                  {{ $id = index $m 1 }}
                {{ end }}

                <iframe
                  width="100%"
                  height="100%"
                  src="https://www.youtube.com/embed/{{ $id }}"
                  title="{{ with $v.title }}{{ . }}{{ else }}Video demo {{ add $i 1 }}{{ end }}"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen
                ></iframe>
              {{ else if $v.src }}
                <video controls preload="metadata" playsinline>
                  <source src="{{ $v.src | relURL }}" type="video/mp4">
                </video>
              {{ else }}
                <div class="cinema-card-body">
                  <div class="cinema-card-title">Thiếu link video</div>
                  <div class="cinema-card-note">Thêm videos[].youtube trong index.md</div>
                </div>
              {{ end }}
            </div>

            <div class="cinema-card-body">
              <div class="cinema-card-title">
                {{ with $v.title }}{{ . }}{{ else }}Video demo {{ add $i 1 }}{{ end }}
              </div>
              {{ with $v.note }}<div class="cinema-card-note">{{ . }}</div>{{ end }}
            </div>
          </article>
        {{ end }}
      {{ else }}
        <article class="cinema-card surface-soft">
          <div class="cinema-card-body">
            <div class="cinema-card-title">Thiếu dữ liệu videos</div>
            <div class="cinema-card-note">Thêm .Params.videos (2 video) trong content/projects/cinemas/index.md</div>
          </div>
        </article>
      {{ end }}
    </div>

    {{ if .Content }}
      <div class="cinema-desc surface-soft">
        <div class="prose">{{ .Content }}</div>
      </div>
    {{ end }}
  </section>

</section>
{{ end }}
